<!DOCTYPE html>
<html>
<head><title>Messages (Admin Only)</title></head>
<body>
  <h2>Send Message</h2>
  <form onsubmit="sendMessage(event)">
    <input type="text" id="to" placeholder="To (e.g. Grade 9)" required><br>
    <textarea id="message" placeholder="Message content" rows="5" cols="40" required></textarea><br>
    <button type="submit">Send</button>
  </form>
  <p id="feedback"></p>
  <button onclick="logout()">Logout</button>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    auth.onAuthStateChanged(user => {
      if (!user || !user.email.includes('admin')) {
        alert('Access denied. Admins only.');
        window.location.href = 'login.html';
      }
    });

    function logout() {
      auth.signOut().then(() => window.location.href = 'login.html');
    }

    function sendMessage(e) {
      e.preventDefault();
      const to = document.getElementById("to").value;
      const message = document.getElementById("message").value;
      db.collection("messages").add({ to, message, date: new Date().toISOString() })
        .then(() => document.getElementById("feedback").innerText = "Message sent.")
        .catch(err => alert(err.message));
    }
  </script>
</body>
</html>