<!DOCTYPE html>
<html>
<head>
  <title>Dynamic Report Card</title>
  <style>
    body { font-family: Arial; margin: 20px; max-width: 800px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #000; padding: 8px; text-align: center; }
    .print-btn { margin-top: 20px; }
    .position-circle {
      position: absolute;
      top: 10px; left: 10px;
      border: 2px solid black;
      border-radius: 50%;
      width: 60px; height: 60px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="position-circle" id="position">3rd</div>
  <h2 style="text-align:center;">RAMA SDA JUNIOR SCHOOL</h2>
  <p style="text-align:center;"><em>IN GOD WE CAN</em></p>

  <input type="text" id="assessNo" placeholder="Enter Assessment No">
  <button onclick="loadReport()">Load Report</button>

  <div id="reportCard"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    const db = firebase.firestore();

    function loadReport() {
      const assessNo = document.getElementById("assessNo").value;
      db.collection("marks").doc(assessNo).get().then(doc => {
        if (doc.exists) {
          const data = doc.data();
          let total = 0;
          let count = 0;
          let rows = "";
          for (let [subj, marks] of Object.entries(data)) {
            rows += `<tr><td>${subj}</td><td>${marks}</td></tr>`;
            total += Number(marks);
            count++;
          }
          const avg = total / count;
          const grade = avg >= 80 ? 'A' : avg >= 70 ? 'B+' : avg >= 60 ? 'B' : avg >= 50 ? 'C' : 'D';
          const pl = avg >= 80 ? 'EX' : avg >= 70 ? 'VG' : avg >= 60 ? 'G' : avg >= 50 ? 'S' : 'B';
          const al = avg >= 80 ? 'AL4' : avg >= 70 ? 'AL3' : avg >= 60 ? 'AL2' : 'AL1';

          document.getElementById("reportCard").innerHTML = `
            <h3>Assessment No: ${assessNo}</h3>
            <table><thead><tr><th>Subject</th><th>Marks</th></tr></thead><tbody>${rows}</tbody></table>
            <p><strong>Total Marks:</strong> ${total}</p>
            <p><strong>Average:</strong> ${avg.toFixed(2)}</p>
            <p><strong>Grade:</strong> ${grade}</p>
            <p><strong>PL:</strong> ${pl} &nbsp;&nbsp; <strong>AL:</strong> ${al}</p>
            <p><strong>Teacher Remarks:</strong> Keep it up.</p>
            <p><strong>HOI Remarks:</strong> Promoted to next grade.</p>
            <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print</button>
          `;
        } else {
          document.getElementById("reportCard").innerHTML = "<p>No report found.</p>";
        }
      });
    }
  </script>
</body>
</html>